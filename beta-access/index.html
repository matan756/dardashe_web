<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const supabase = window.supabase.createClient(
    'https://wqgnwcluodmwszgjtona.supabase.co',
    'sb_publishable_fNMgEK319mUQHpRTVjgtzg_Hymx2to6'
  );

  const form = document.getElementById('betaForm');
  const messageDiv = document.getElementById('message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    messageDiv.textContent = '';
    messageDiv.className = '';

    const full_name = form.full_name.value.trim() || null;
    const phone_number = form.phone_number.value.trim() || null;
    const email = form.email.value.trim();
    const consent = form.consent.checked;

    form.querySelector('button[type="submit"]').disabled = true;

    try {
      const { error } = await supabase
        .from('beta_signups')
        .insert([{
          full_name,
          phone_number,
          email,
          consent,
          source: 'exchange_program'
        }]);

      if (error) throw error;

      form.reset();
      messageDiv.className = 'success';
      messageDiv.textContent = phone_number
        ? 'תודה! תוך 24 שעות יתקבל קישור למספר הטלפון שהזנת.'
        : 'תודה! תוך 24 שעות יתקבל קישור לכתובת המייל שהזנת.';

    } catch (err) {
      console.error('Supabase error:', err);
      messageDiv.className = 'error';
      messageDiv.textContent =
        'שגיאה בשליחה, יש לנסות שוב. אם הבעיה ממשיכה, פנו אלינו ל-support@dardashe.co.il';
    } finally {
      form.querySelector('button[type="submit"]').disabled = false;
    }
  });

});
</script>
